---
- name: Setup student accounts for magnum on bastion
  hosts: localhost
  connection: local

  tasks:
  - name: Create student accounts
    become: yes
    user:
      name: "{{ item }}"
      password: "{{ lookup('password', 'credentials/' + item + '/password.txt encrypt=md5_crypt') }}"
      state: present
    with_sequence: start=0 end=40 format=student%02x

  - name: Check if student namespace exists
    shell: kubectl get namespaces |grep student
    ignore_errors: yes
    register: namespace_get

  - name: Create student namespace
    shell: kubectl create namespace {{ item }}
    with_sequence: start=0 end=40 format=student%02x
    when: namespace_get.rc != 0
